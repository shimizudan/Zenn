---
title: "標本標準偏差の期待値は母標準偏差に等しいのか？"
emoji: "📊"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["statistics", "julia", "math"]
published: false
---

## はじめに

高校数学B「確率分布と統計的な推測」の単元では、標本標準偏差 $S$ について次のように説明されています：

> 標本の大きさ $n$ が大きいときには、$\sigma$ の代わりに標本標準偏差 $S$ の値を用いても差し支えない。

この「差し支えない」とは、**どのような意味**なのでしょうか？

- 標本標準偏差の期待値 $E(S)$ は母標準偏差 $\sigma$ に等しいのか？
- もし等しくないなら、どの程度の誤差があるのか？
- 「$n$ が大きいとき」とは、具体的にどのくらいの大きさなのか？

これが本記事を書いた最初のモチベーションです。

統計学を学ぶと、標本分散には「不偏分散（n-1で割る）」と「標本分散（nで割る）」の2種類があることを知ります。不偏分散は母分散の不偏推定量になるため、推測統計では広く使われています。

では、**標本標準偏差**はどうでしょうか？

標本標準偏差を次のように定義します：

$$
S = \sqrt{\frac{1}{n}\sum_{k=1}^n (X_k - \overline{X})^2}
$$

この記事では、上記の疑問について、数学的な考察とJuliaによる数値実験で検証します。

## 標本分散の期待値

まず、標本分散 $S^2$ の期待値を確認しましょう。

$$
S^2 = \frac{1}{n}\sum_{k=1}^n (X_k - \overline{X})^2
$$

この期待値は次のようになることが知られています：

$$
E(S^2) = \left(1 - \frac{1}{n}\right)\sigma^2
$$

これは母分散 $\sigma^2$ よりも小さく、**バイアス（偏り）**があります。これが不偏分散で $n-1$ で割る理由です。

## 標本標準偏差の期待値：凸不等式からのアプローチ

標本分散の平方根の期待値を考えます。ここで重要なのが**イェンセンの不等式（凸不等式）**です。

平方根関数 $f(x) = \sqrt{x}$ は凹関数なので：

$$
\sqrt{E(S^2)} \geq E(\sqrt{S^2}) = E(S)
$$

つまり：

$$
\sqrt{E(S^2)} = \sqrt{1 - \frac{1}{n}} \cdot \sigma \geq E(S)
$$

さらに、標本標準偏差 $S$ の確率分布を考えると、次の不等式が成り立ちます：

$$
\sigma \geq \sqrt{E(S^2)} \geq E(S)
$$

この不等式から、**$E(S)$ は常に $\sigma$ より小さい**ことがわかります。

## では、nが大きいとき $E(S) \simeq \sigma$ となるのか？

画像で示された疑問は、まさにここです。

$$
\sqrt{1 - \frac{1}{n}} \cdot \sigma \xrightarrow{n \to \infty} \sigma
$$

なので、$E(S)$ も $\sigma$ に近づきそうです。しかし、**厳密には等しくなりません**。

正規分布の場合、次の関係式が成り立ちます：

$$
E(S) = c_4(n) \cdot \sigma
$$

ここで、$c_4(n)$ は補正係数で：

$$
c_4(n) = \sqrt{\frac{2}{n-1}} \cdot \frac{\Gamma(n/2)}{\Gamma((n-1)/2)}
$$

この $c_4(n)$ は $n \to \infty$ で 1 に近づきますが、常に $c_4(n) < 1$ です。

近似式として：

$$
c_4(n) \approx 1 - \frac{1}{4n} - \frac{7}{32n^2} - \frac{19}{128n^3} + \cdots
$$

つまり、**バイアスは $O(1/n)$ で減少**しますが、0にはなりません。

## Juliaによる数値実験

理論を検証するため、Juliaでモンテカルロシミュレーションを行いました。

### シミュレーションコード

正規分布 $N(0, \sigma^2)$ からのサンプリングを繰り返し、標本標準偏差 $S$ の期待値を推定します。

```julia
using Statistics
using Random
using Printf
using SpecialFunctions

function simulate_sample_std(n::Int, σ::Real, num_trials::Int=10000)
    Random.seed!(42)

    S_values = Float64[]
    S2_values = Float64[]

    for _ in 1:num_trials
        # 正規分布 N(0, σ²) からサンプリング
        sample = randn(n) * σ

        # 標本分散 S² = (1/n) Σ(Xₖ - X̄)²
        S2 = var(sample, corrected=false)  # corrected=false で n で割る

        # 標本標準偏差 S = √S²
        S = sqrt(S2)

        push!(S_values, S)
        push!(S2_values, S2)
    end

    mean_S = mean(S_values)
    mean_S2 = mean(S2_values)
    sqrt_mean_S2 = sqrt(mean_S2)

    return mean_S, mean_S2, sqrt_mean_S2
end

function bias_factor(n::Int)
    sqrt(2/(n-1)) * gamma(n/2) / gamma((n-1)/2)
end
```

### 実験結果

母集団の標準偏差 $\sigma = 1.0$ として、異なるサンプルサイズで実験しました。

| n | E(S) | √E(S²) | σ | c₄(n) |
|------|----------|----------|------|--------|
| 5 | 0.841524 | 0.895089 | 1.0 | 0.939986 |
| 10 | 0.923681 | 0.949504 | 1.0 | 0.972659 |
| 20 | 0.963374 | 0.975993 | 1.0 | 0.986934 |
| 50 | 0.984053 | 0.989067 | 1.0 | 0.994911 |
| 100 | 0.992320 | 0.994801 | 1.0 | 0.997478 |
| 200 | 0.996170 | 0.997448 | 1.0 | 0.998745 |
| 500 | 0.998331 | 0.998827 | 1.0 | 0.999499 |
| 1000 | 0.999051 | 0.999303 | 1.0 | 0.999750 |
| 5000 | 0.999870 | 0.999921 | 1.0 | 0.999950 |
| 10000 | 0.999843 | 0.999868 | 1.0 | 0.999975 |

### バイアスの減少

バイアス $\sigma - E(S)$ は、近似的に $1/(4n)$ で減少します。

| n | σ - E(S) | 1/(4n) |
|-------|-------------|---------|
| 10 | 0.0763 | 0.0250 |
| 50 | 0.0159 | 0.0050 |
| 100 | 0.0077 | 0.0025 |
| 500 | 0.0017 | 0.0005 |
| 1000 | 0.0009 | 0.0003 |
| 5000 | 0.0001 | 0.0001 |
| 10000 | 0.0002 | 0.0000 |

## 連続写像定理と標本標準偏差の一致性

標本標準偏差が母標準偏差に「収束する」という性質を、より厳密に理解するために、**連続写像定理（Continuous Mapping Theorem）**について解説します。

### 連続写像定理とは

連続写像定理は、確率論における基本的な定理の一つで、次のように述べられます：

**定理（連続写像定理）**
- 確率変数列 $X_n$ が $X$ に確率収束するとき（$X_n \xrightarrow{p} X$）
- 関数 $g$ が連続であれば
- $g(X_n) \xrightarrow{p} g(X)$（$g(X_n)$ も $g(X)$ に確率収束する）

同様に、分布収束（$X_n \xrightarrow{d} X$）についても成り立ちます。

### 標本標準偏差への応用

標本分散 $S^2 = \frac{1}{n}\sum_{k=1}^n (X_k - \overline{X})^2$ について、大数の法則により：

$$
S^2 \xrightarrow{p} \sigma^2 \quad (n \to \infty)
$$

ここで、平方根関数 $g(x) = \sqrt{x}$ は $x > 0$ で連続なので、連続写像定理を適用すると：

$$
S = \sqrt{S^2} = g(S^2) \xrightarrow{p} g(\sigma^2) = \sqrt{\sigma^2} = \sigma
$$

つまり、**標本標準偏差 $S$ は母標準偏差 $\sigma$ に確率収束します**。これが $S$ が**一致推定量（consistent estimator）**であることの証明です。

### 確率収束の意味

確率収束 $S \xrightarrow{p} \sigma$ とは、次のことを意味します：

$$
\lim_{n \to \infty} P(|S - \sigma| > \epsilon) = 0 \quad (\forall \epsilon > 0)
$$

つまり、$n$ を大きくすると、$S$ が $\sigma$ から $\epsilon$ 以上離れる確率が 0 に近づきます。

### 連続写像定理が保証しないこと

重要な注意点として、連続写像定理は以下のことを**保証しません**：

1. **期待値の等しさ**: $E(S) = \sigma$ とは限らない（実際、$E(S) < \sigma$）
2. **収束の速度**: どのくらいの速さで収束するかは分からない
3. **漸近分布の形**: $\sqrt{n}(S - \sigma)$ の極限分布については何も言わない

期待値については、**イェンセンの不等式**により：

$$
E(S) = E(\sqrt{S^2}) < \sqrt{E(S^2)} < \sigma \quad (\because \sqrt{x} \text{ は凹関数})
$$

つまり、**確率収束（一致性）**と**不偏性（$E(S) = \sigma$）**は別の概念です。

### 漸近分布：デルタ法

標本標準偏差の漸近分布を調べるには、**デルタ法（Delta method）**を用います。

正規分布 $N(\mu, \sigma^2)$ の場合、不偏分散 $\hat{\sigma}^2 = \frac{1}{n-1}\sum_{k=1}^n (X_k - \overline{X})^2$ について：

$$
\sqrt{n}(\hat{\sigma}^2 - \sigma^2) \xrightarrow{d} N(0, \kappa \sigma^4 - \sigma^4) = N(0, (\kappa - 1)\sigma^4)
$$

ここで $\kappa = E[(X - \mu)^4]/\sigma^4$ は尖度です。正規分布では $\kappa = 3$ なので：

$$
\sqrt{n}(\hat{\sigma}^2 - \sigma^2) \xrightarrow{d} N(0, 2\sigma^4)
$$

デルタ法により、$g(x) = \sqrt{x}$ として、$g'(\sigma^2) = 1/(2\sigma)$ なので：

$$
\sqrt{n}(\sqrt{\hat{\sigma}^2} - \sigma) \xrightarrow{d} N\left(0, [g'(\sigma^2)]^2 \cdot 2\sigma^4\right) = N\left(0, \frac{\sigma^2}{2}\right)
$$

これは、標本標準偏差の標準誤差が $\sigma/\sqrt{2n}$ 程度であることを示しています。

### スラツキーの定理との違い

よく混同されるのが**スラツキーの定理（Slutsky's theorem）**です：

**定理（スラツキーの定理）**
- $X_n \xrightarrow{d} X$ かつ $Y_n \xrightarrow{p} c$（$c$ は定数）
- ならば $g(X_n, Y_n) \xrightarrow{d} g(X, c)$

スラツキーの定理は、一方が**定数に収束する**場合に適用されます。例えば：

- 標本平均 $\overline{X}_n \xrightarrow{p} \mu$（定数）
- 中心極限定理 $\sqrt{n}(\overline{X}_n - \mu) \xrightarrow{d} N(0, \sigma^2)$
- $t$ 統計量の構成などに使われる

しかし、標本標準偏差 $S$ 自体の収束を考える場合は、単に**連続写像定理**で十分です。

### まとめ：連続写像定理と標本標準偏差

1. **連続写像定理**: $S^2 \xrightarrow{p} \sigma^2$ と平方根の連続性から $S \xrightarrow{p} \sigma$（一致性）
2. **イェンセンの不等式**: $E(S) < \sigma$ なので不偏性は成り立たない
3. **デルタ法**: 漸近分布を調べると $\sqrt{n}(S - \sigma) \xrightarrow{d} N(0, \sigma^2/2)$（正規分布の場合）
4. **結論**: $S$ は一致推定量だが、有限標本では常にバイアスがある

## 結論

### 数学的な結論

1. **凸不等式 $\sigma \geq \sqrt{E(S^2)} \geq E(S)$ が常に成立**
2. **nが大きくなると $E(S)$ は $\sigma$ に近づくが、厳密には $E(S) = c_4(n) \cdot \sigma < \sigma$**
3. **補正係数 $c_4(n) \approx 1 - \frac{1}{4n}$ なので、バイアスは $O(1/n)$ で減少**
4. **実用上、nが十分大きければ（例：n ≥ 100）、$E(S) \approx \sigma$ と近似してよい**

### 元の疑問「標本標準偏差 $S$ は $\sigma$ の代わりに用いてよいのか？」への答え

**答え：標本標準偏差 $S$ は漸近的不偏推定量であり、教科書の記述は正しい**

統計学の用語で厳密に述べると：

- **有限標本では偏りがある（biased）**: 任意の有限な $n$ に対して $E(S) < \sigma$
- **漸近的不偏性（asymptotic unbiasedness）を持つ**: $\lim_{n \to \infty} E(S) = \sigma$
- **一致推定量（consistent estimator）である**: $S \xrightarrow{p} \sigma$ （確率収束）
- バイアスは $O(1/n)$ で減少するため、実用上は $n$ が大きければ無視できる

#### 用語の定義

- **不偏推定量（unbiased estimator）**: 推定量 $\hat{\theta}$ が $E(\hat{\theta}) = \theta$ を満たすとき、$\hat{\theta}$ は $\theta$ の不偏推定量という
- **漸近的不偏推定量（asymptotically unbiased estimator）**: $\lim_{n \to \infty} E(\hat{\theta}_n) = \theta$ を満たすとき、$\hat{\theta}_n$ は漸近的不偏推定量という
- **一致推定量（consistent estimator）**: 推定量 $\hat{\theta}_n$ が $\hat{\theta}_n \xrightarrow{p} \theta$ を満たすとき（任意の $\epsilon > 0$ に対して $\lim_{n \to \infty} P(|\hat{\theta}_n - \theta| > \epsilon) = 0$）、$\hat{\theta}_n$ は一致推定量という

### 教科書の記述の評価

高校数学の教科書に書かれている「標本の大きさ $n$ が大きいときには、$\sigma$ の代わりに標本標準偏差 $S$ の値を用いても差し支えない」という記述について、以下のように評価できます：

#### ✅ 正しい点

1. **漸近的には正しい**: $n \to \infty$ で $E(S) \to \sigma$ なので、$n$ が十分大きければ $S \approx \sigma$ とみなせる
2. **実用的**: 教科書の例題（$n = 2500$）では、バイアスは約 $1/(4 \times 2500) = 0.0001$ と非常に小さい
3. **信頼区間の構成には影響が小さい**: 信頼区間の幅は $1.96 \cdot S/\sqrt{n}$ の形なので、$S$ のバイアスは $1/\sqrt{n}$ でさらに減衰される

#### ⚠️ 注意すべき点

1. **厳密には不偏ではない**: 任意の有限な $n$ に対して $E(S) < \sigma$ であり、常に過小推定のバイアスがある
2. **小標本では無視できない**: $n = 10$ では約 7.6% の偏りがあり、$n = 30$ でも約 2.5% の偏りがある
3. **「差し支えない」の意味が曖昧**: 数学的に厳密な意味では等しくないが、実用上は問題ないという意味

#### 結論：教科書の記述は実用的には正しい

教科書が想定している場面（例題では $n = 2500$）のように、$n$ が数百以上の大標本であれば、標本標準偏差 $S$ を母標準偏差 $\sigma$ の代わりに用いても、実用上の問題はほとんどありません。

ただし、より厳密には：

- **小標本（$n < 30$）では**: 不偏標準偏差 $\sqrt{\frac{n}{n-1}} S$ や、補正係数 $1/c_4(n)$ を用いた補正が推奨される
- **標準偏差そのものを推定する場合**: 母標準偏差の不偏推定量を用いる方が望ましい
- **信頼区間の構成**: $n$ が大きければ、$S$ を用いても $\sigma$ を用いても、信頼区間への影響は極めて小さい

つまり、「差し支えない」とは「厳密には等しくないが、実用上の誤差は無視できる程度に小さい」という意味であり、**統計学的に正当化される記述**と言えます。

## 参考

- [標本標準偏差 - Wikipedia](https://ja.wikipedia.org/wiki/%E6%A8%99%E6%BA%96%E5%81%8F%E5%B7%AE)
- イェンセンの不等式
- ガンマ関数と補正係数 $c_4(n)$

## コード

本記事で使用したJuliaコードは、GitHubで公開しています。

https://github.com/dannchu/zenn-articles

ぜひ実際に実行して、結果を確認してみてください！
